{
    "contents" : "################################################################\n\n#Import Libraries\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(plyr)\n\n#delete function\ndelete.na <- function(df, n=0) {\n  log <- apply(df, 2, is.na)\n  logindex <- apply(log, 1, function(x) sum(x) <= n)\n  df[logindex, ]\n}\n\n#clear previous stuff\nrm(df)\nrm(df.merge)\nrm(df.norm)\nrm(df.norm_melt)\nrm(df.norm_scaled)\nrm(dfSubset)\nrm(dfSubset2)\nrm(statsdf)\nrm(df.melt)\nrm(melt.normalizedData)\nrm(normalizedData)\n#setwd(\"Data/Raw Data\")\nsetwd(\"/Volumes/mainland/Projects/TMA blocker/Split Nostril Study/Setup1/\")\n\n\n\n#read all files from directory\nsubj <- dir(path = \"Data/\", pattern=\"\\\\.txt$\", full.names=TRUE)# creating a list of all file names\nnames(subj)  <- basename(subj)\ndf  <- ldply(subj, read.delim, stringsAsFactors=FALSE)\n\n#subsetdata to get rid of test mode and include only relevant columnss\ndfSubset  <- subset(df, Procedure.SubTrial. == \"RatingProc\", select = c (\"Subject\", \"Session\", \"Running.Block.\",  \"Trial\", \"Procedure.Trial.\", \"BlockRating.SubTrial.\", \"BlockRating\", \"TMARating.SubTrial.\", \"TMARating\", \"Straw1and2\", \"Straw3and4\", \"Jar1\", \"Jar2\", \"Jar3\", \"Jar4\"))\n#Combine the weird thing that's happening with the two different columns for rating...\n\n\n\n\nfor(i in 1:length(dfSubset$TMARating)){\n  if(is.na(dfSubset$TMARating[i])){\n    dfSubset$TMARating[i] <- dfSubset$TMARating.SubTrial.[i]\n    dfSubset$BlockRating[i] <- dfSubset$BlockRating.SubTrial.[i]\n    }\n  }\ndfSubset <- subset(dfSubset, select = -c(TMARating.SubTrial.,BlockRating.SubTrial.))\n\n\n#Get rid of Joel and Wendy's data because Joel is missing some datapoints, and Wendy can't smell TMA well\n#also they were both run before odors were refreshed\n#dfSubset <- dfSubset[which(dfSubset$Subject != 6 & dfSubset$Subject !=7 & dfSubset$Subject != 10),] #These people couldn't tell nonenol from TMA very well\ndfSubset <- dfSubset[which(dfSubset$Subject != 2 & dfSubset$Subject != 3 & dfSubset$Subject !=7),]\n#need to go back and connect this to quiz data\n\n\n#cONVErT SCALES\ndfSubset$TMA  <- 401-as.integer(dfSubset$TMARating)\ndfSubset$Antag  <- 401 - as.integer(dfSubset$BlockRating)\n\ntest <- dfSubset[which(dfSubset$TMA < 0 | dfSubset$Antag <0),] #check this to make sure none of the values are negative\n#I changed the size of the allowable rectangle for clicks in the program, so the scale is not perfectly from 400 to 50 in pixel distance\n#This should not be a problem for the ratings because they are normalized in the next steps\ndfSubset <- delete.na(dfSubset)\n\nValveCode <- read.csv(\"Valve_code.csv\", header=TRUE, sep=\",\", stringsAsFactors=TRUE)\n\nValveCode$Running.Block. <- NULL\nfor(i in 1:length(ValveCode$Trial)){\n  if(ValveCode$Block[i] == \"Nonenol\"){\n    ValveCode$Running.Block.[i] <- \"Test1\"\n  }\n  if(ValveCode$Block[i] == \"Linalool\"){\n    ValveCode$Running.Block.[i] <- \"Test2\"\n  }\n}\n\nValveCode2 <- subset(ValveCode, select = -c(TMALeftRight))\n\ndf.merge  <- merge(dfSubset, ValveCode2, c(\"Running.Block.\", \"Trial\"))\ndf.merge <- subset(df.merge, select = c(\"Subject\", \"TMA\", \"Antag\", \"Block\", \"Odor\", \"NostrilType\"))\ndf.melt <- melt(df.merge, c(\"Subject\", \"Block\", \"Odor\", \"NostrilType\"))\n\n\n#Raw data graphed poorly by individuals\n#pdf(\"pilot.pdf\", height = 8, width = 11)\nggplot(data = subset(df.melt, variable == \"Antag\"), aes(x = Odor, y = value, colour = NostrilType)) +\n    geom_boxplot() +\n    facet_grid(Block~Subject)\n#dev.off()\n\n\n\n#Normalize data\nnormalizedData <- ddply(df.merge, .variables = c(\"Subject\", \"Block\"), transform, TMANorm = scale(TMA), antagNorm = scale(Antag))\n\n#melt normalized Data\nmelt.normalizedData <- melt(normalizedData, c(\"Subject\", \"Block\", \"Odor\", \"NostrilType\"))\n\n#plot normalized data individually\n#pdf(\"alldata.pdf\", height = 8, width = 11)\nggplot(data = normalizedData, aes(x = Odor, y = TMANorm, colour = NostrilType)) +\n  geom_boxplot() +\n  facet_grid(Block~Subject)\n#dev.off()\n\n#################################\n#Try to graph central versus peripheral blocking\n################################\n#Start with unnormalized data\n# df.merge$Odor_Nostril <- paste(df.merge$Odor, df.merge$NostrilType, sep = \" \")\n# \n# averageByTrialType <- ddply(df.merge, .(Subject, Block, Odor_Nostril), .fun = summarize, avg = mean(TMA))\n# averageByTrialTypeCast <- dcast(averageByTrialType, Subject~Odor_Nostril, value.var = \"avg\")\n\n\n",
    "created" : 1449522483469.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1320758533",
    "id" : "43322B10",
    "lastKnownWriteTime" : 1449866959,
    "path" : "/Volumes/mainland/Projects/TMA blocker/Split Nostril Study/Setup1/Code/SplitNostrilSetup1.R",
    "project_path" : "SplitNostrilSetup1.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}